# ThermalCam Code Summary

본 문서는 `thermalcam` 프로젝트의 전체 Python 코드 구조를 분석하여 다음 항목을 포함합니다:

1. 정의된 모든 함수 및 클래스 이름
2. 각 함수/클래스의 인자(매개변수)
3. 각 항목의 역할을 한 문장으로 요약
4. 각 파일이 전체 프로그램 흐름에서 수행하는 역할 요약

---

## 📁 thermalcam/core

| 파일명             | 구성 요소                                                           | 인자                                    | 역할 요약 |
| ------------------ | ------------------------------------------------------------------- | --------------------------------------- | --------- |
| `alarm.py`         | `fetch_alarm_conditions(ip, user_id, user_pw)`                      | 카메라에서 ROI 알람 조건을 불러옴       |           |
|                    | `evaluate_alarms(rois, thermal_data)`                               | 실시간 온도와 알람 조건 비교 평가       |           |
| `camera_client.py` | `ThermalReceiver(host, port, data_store, on_roi_refresh, roi_data)` | TCP 데이터 수신 및 알람 평가 처리       |           |
| `focus.py`         | `FocusController(get_ip_func, get_speed_func)`                      | 카메라 초점 조절 명령 반복 전송         |           |
| `frame_reader.py`  | `FrameReader(url, delay_sec)`                                       | RTSP 영상 스트리밍 + 지연 프레임 제공   |           |
| `roi.py`           | `fetch_all_rois(ip, user_id, user_pw)`                              | ROI/알람/ISO 데이터 파싱 후 리스트 반환 |           |
|                    | `draw_rois(frame, rois, thermal_data, scale_x, scale_y)`            | 프레임 위에 ROI 및 알람 결과 시각화     |           |
| `yolo.py`          | `YOLODetector(model_path='yolov8n.pt')`                             | YOLOv8 모델 로딩 및 객체 탐지 수행      |           |
|                    | `detect(frame)`                                                     | 객체 감지 결과 반환                     |           |
|                    | `draw_detections(frame, detections)`                                | 객체 탐지 박스를 프레임에 표시          |           |

**역할 요약:** 센서/ROI/알람 등 핵심 기능과 영상 연산 처리 담당

---

## 📁 thermalcam/ui

### 📄 `main_window.py`

- `OpenCVViewer` 클래스:

  - RTSP 영상 표시, ROI 시각화, TCP 온도 수신, YOLO 탐지 등 전체 기능 통합 GUI

### 📄 `graph_window.py`

- `GraphWindow(ip)` 클래스:

  - TCP 실시간 온도 수치를 matplotlib 그래프로 시각화함

### 📄 `stream_handler.py`

| 함수                   | 인자 | 역할                                 |
| ---------------------- | ---- | ------------------------------------ |
| `start_stream(viewer)` | 없음 | ROI 메타정보 로드 및 RTSP + TCP 시작 |
| `stop_stream(viewer)`  | 없음 | 모든 스트림/타이머 종료              |
| `update_frame(viewer)` | 없음 | 프레임을 갱신하고 ROI/YOLO 적용      |

### 📄 `roi_display_handler.py`

| 함수                                                 | 인자                           | 역할                   |
| ---------------------------------------------------- | ------------------------------ | ---------------------- |
| `init_roi_labels(viewer)`                            | 없음                           | ROI 테이블 라벨 초기화 |
| `process_roi_display(viewer, rgb, scale_x, scale_y)` | ROI 알람 시각화, 라벨 업데이트 |                        |
| `refresh_rois(viewer)`                               | ROI/알람 조건 갱신 처리        |                        |

### 📄 `yolo_handler.py`

- `handle_yolo_detection(viewer, rgb)`: YOLO 탐지 + 감지 시 캡처 저장

---

## 📁 dialogs/camera_controls

| 파일명           | 클래스                    | 인자                 | 역할 요약                                |
| ---------------- | ------------------------- | -------------------- | ---------------------------------------- |
| `correction.py`  | `CorrectionControlPopup`  | ip, user_id, user_pw | 온도 보정 파라미터 설정 UI               |
| `display.py`     | `DisplayControlPopup`     | ip, user_id, user_pw | 영상 표시 관련 설정 UI                   |
| `enhancement.py` | `EnhancementControlPopup` | ip, user_id, user_pw | 영상 품질 향상 관련 UI                   |
| `image.py`       | `ImageControlPopup`       | ip, user_id, user_pw | 색상, 밝기, 콘트라스트 등 이미지 설정 UI |
| `nuc.py`         | `NUCControlPopup`         | ip, user_id, user_pw | NUC (비균일 보정) 설정 UI                |

---

## 📁 dialogs/roi_editor

| 파일명                   | 구성 요소                                        | 인자                                 | 역할 요약 |
| ------------------------ | ------------------------------------------------ | ------------------------------------ | --------- |
| `roi_editor_main.py`     | `SetROIPopup(ip, user_id, user_pw, main_window)` | ROI 설정 팝업 전체 구성과 연결       |           |
| `roi_loader.py`          | `ROILoader(...)`                                 | ROI/알람/ISO 데이터 테이블에 로딩    |           |
| `roi_loader_thread.py`   | `ROILoaderThread(...)`                           | RTSP 프레임 + ROI 병렬 로딩          |           |
| `roi_drawer.py`          | `ROIDrawer(...)`                                 | 테이블 기반 ROI 사각형 이미지에 그림 |           |
| `roi_capture_handler.py` | `ROICaptureHandler(...)`                         | ROI 직접 그리기 결과 테이블 반영     |           |
| `roi_saver.py`           | `ROISaver(...)`                                  | ROI/알람/ISO 설정을 카메라에 저장    |           |
| `roi_sync.py`            | `ROISyncManager(...)`                            | 세 테이블 간 사용 상태 동기화 처리   |           |
| `rtsp_utils.py`          | `load_rtsp_frame(ip)`                            | RTSP 스트림에서 프레임 1장 캡처      |           |

---

## 📁 widgets

| 파일명                  | 클래스            | 역할 요약                                                       |
| ----------------------- | ----------------- | --------------------------------------------------------------- |
| `roi_capture_widget.py` | `ROICaptureLabel` | ROI 직접 드래그/이동/선택 UI 위젯, paintEvent 커스터마이징 포함 |

---

## 📄 cli.py

| 함수     | 역할 요약                                                         |
| -------- | ----------------------------------------------------------------- |
| `main()` | `QApplication` 실행 및 `OpenCVViewer` 띄움 (프로그램 실행 진입점) |

---

## 📋 누락 확인 (structure.txt 기준)

- ✅ `thermalcam/core` → 전부 포함됨
- ✅ `thermalcam/ui` → `dialogs`, `widgets`, 각 개별 py 파일 포함됨
- ✅ `resources/icons`/`models`/`ui` 등은 `.ui`/`.pt`/`.gif`로 코드 요약 제외 대상
- ✅ 실행 진입점 `cli.py` 포함됨

✅ 최종적으로 모든 주요 `.py` 코드 파일 분석 및 요약 완료.
